!function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(1),r=(i.n(n),i(2)),s=(i.n(r),i(3)),a=(i.n(s),i(4)),o=i(5),h=i(6),u=i(8),c=i(9);new Vue({el:"#app",data:{init:!1,visible:!0,playing:!1,loading:!1,sidebar:!1,volume:.5,route:"/",channels:[],channel:{},songs:[],track:{},favorites:[],errors:{},timeStart:0,timeDisplay:"00:00:00",timeItv:null,searchText:"",sortParam:"listeners",sortOrder:"desc",anf:null,sto:null,itv:null},watch:{playing:function(){this.playing?this.startClock():this.stopClock()},volume:function(){o.a.setVolume(this.volume)}},computed:{channelsList:function(){var t=this,e=this.channels.slice(),i=this.searchText.replace(/[^\w\s\-]+/g,"").replace(/[\r\s\t\n]+/g," ").trim();return i&&i.length>1&&(e=u.a.search(e,"title",i)),this.sortParam&&(e=u.a.sort(e,this.sortParam,this.sortOrder,!1)),this.channel.id&&(e=e.map(function(e){return e.active=t.channel.id===e.id,e})),e},songsList:function(){return this.songs.slice()},sortLabel:function(){switch(this.sortParam){case"title":return"Station Name";case"listeners":return"Listeners Count";case"favorite":return"Saved Favorites";case"genre":return"Music Genre"}},canPlay:function(){return!(!this.channel.id||this.loading)},hasChannel:function(){return!!this.channel.id},hasSongs:function(){return!!this.songs.length},hasErrors:function(){return!(!this.errors.support&&!this.errors.stream)||!(!this.errors.channels||this.channels.length)}},methods:{setupMaintenance:function(){var t=this;this.itv=setInterval(function(){t.getChannels(t.sidebar),t.getSongs(t.channel)},3e4)},setError:function(t,e){var i=Object.assign({},this.errors);i[t]=String(e||"").trim(),e&&console.warn("ERROR("+t+"):",e),this.errors=i},clearError:function(t){var e=Object.assign({},this.errors);delete e[t],this.errors=e},hasError:function(t){return t&&this.errors.hasOwnProperty(t)},flushErrors:function(){this.errors={}},setupEvents:function(){var t=this;document.addEventListener("visibilitychange",function(e){t.visible="visible"===document.visibilityState}),window.addEventListener("hashchange",function(e){return t.applyRoute(window.location.hash)}),window.addEventListener("keydown",this.onKeyboard),o.a.on("waiting",this.onWaiting),o.a.on("playing",this.onPlaying),o.a.on("ended",this.onEnded),o.a.on("error",this.onError)},initPlayer:function(){document.querySelector("#_spnr").style.display="none",document.querySelector("#player-wrap").style.opacity="1",this.init=!0},resetPlayer:function(){this.closeAudio(),this.flushErrors(),this.channel={},this.songs=[]},tryAgain:function(){this.hasError("support")?(this.flushErrors(),setTimeout(this.setupAudio,1)):(this.flushErrors(),this.playChannel(this.channel))},toggleSidebar:function(t){this.sidebar="boolean"==typeof t&&t},togglePlay:function(t){if(t&&t.preventDefault(),!this.loading)return this.playing?this.closeAudio():void this.playChannel(this.channel)},loadSortOptions:function(){var t=c.a.get("sorting_data");t&&t.param&&(this.sortParam=t.param),t&&t.order&&(this.sortOrder=t.order)},toggleSortOrder:function(){this.sortOrder="asc"===this.sortOrder?"desc":"asc"},sortBy:function(t,e){this.sortParam===t?this.toggleSortOrder():this.sortOrder=e||"asc",this.sortParam=t,c.a.set("sorting_data",{param:this.sortParam,order:this.sortOrder})},loadFavorites:function(){var t=c.a.get("favorites_data");Array.isArray(t)&&(this.favorites=t)},saveFavorites:function(){var t=this,e="#EXTM3U",i=!0,n=!1,r=void 0;try{for(var s,a=this.favorites[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var o=s.value;(function(i){var n=t.channels.filter(function(t){return t.id===i}).shift();if(!n)return"continue";e+="\n\n",e+="#EXTINF:0,"+n.title+" [SomaFM]\n",e+=""+n.mp3file})(o)}}catch(t){n=!0,r=t}finally{try{!i&&a.return&&a.return()}finally{if(n)throw r}}var h=document.createElement("a");h.setAttribute("href","data:audio/mpegurl;charset=utf-8,"+encodeURIComponent(e)),h.setAttribute("download","somafm_favorites.m3u"),h.setAttribute("target","_blank"),document.body.appendChild(h),setTimeout(function(){return h.click()},100),setTimeout(function(){return h.remove()},1e3)},toggleFavorite:function(t,e){var i=this.favorites.slice();i=i.filter(function(e){return e!==t}),e&&i.push(t),this.favorites=i,this.updateCurrentChannel(),c.a.set("favorites_data",i)},closeAudio:function(){o.a.stopAudio(),this.playing=!1},setupCanvas:function(){h.a.setupCanvas()},updateCanvas:function(){if(this.anf=requestAnimationFrame(this.updateCanvas),this.visible){var t=o.a.getFreqData(this.playing);h.a.updateObjects(t)}},getChannels:function(t){var e=this;a.a.getChannels(function(i,n){if(i)return e.setError("channels",i);e.channels=n,e.clearError("channels"),e.updateCurrentChannel(),e.applyRoute(window.location.hash,t)})},getSongs:function(t,e){var i=this;t&&t.id&&t.songsurl&&(this.isCurrentChannel(t)||(this.songs=[],this.track={}),a.a.getSongs(t,function(t,n){if(t)return i.setError("songs",t);"function"==typeof e&&e(n),i.track=n.shift(),i.songs=n.slice(0,3),i.clearError("songs")}))},isCurrentChannel:function(t){return!!(t&&t.id&&this.channel.id)&&this.channel.id===t.id},updateCurrentChannel:function(){var t=!0,e=!1,i=void 0;try{for(var n,r=this.channels[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var s=n.value;s.favorite=this.favorites.indexOf(s.id)>=0,this.isCurrentChannel(s)&&(this.channel=Object.assign(this.channel,s),s.active=!0)}}catch(t){e=!0,i=t}finally{try{!t&&r.return&&r.return()}finally{if(e)throw i}}},playChannel:function(t){!this.playing&&t&&t.mp3file&&(this.loading=!0,o.a.setVolume(this.volume),o.a.playSource(t.mp3file))},selectChannel:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t&&t.id&&(this.isCurrentChannel(t)||(this.closeAudio(),this.toggleSidebar(!1),this.setRoute(t.route),this.getSongs(t),this.channel=t,e&&this.playChannel(t)))},setRoute:function(t){t="/"+String(t||"").replace(/^[\#\/]+|[\/]+$/g,"").trim(),window.location.hash=t,this.route=t},applyRoute:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=String(t||"").replace(/^[\#\/]+|[\/]+$/g,"").trim().split("/"),n=i.length?i.shift():"",r=i.length?i.shift():"";if("channel"===n&&r){var s=this.channels.filter(function(t){return t.id===r}).shift();if(s&&s.id)return this.selectChannel(s)}this.closeAudio(),this.resetPlayer(),this.toggleSidebar(e)},onKeyboard:function(t){var e=t.key||"";return" "===e&&this.channel.id?this.togglePlay():"Enter"===e?this.toggleSidebar(!0):"Escape"===e?this.toggleSidebar(!1):void 0},onWaiting:function(t){var e=this;this.sto&&clearInterval(this.sto),this.sto=setTimeout(function(){return e.onError(t)},1e4),this.playing=!1,this.loading=!0},onPlaying:function(t){this.clearError("stream"),this.playing=!0,this.loading=!1},onEnded:function(t){this.playing=!1,this.loading=!1},onError:function(t){this.closeAudio(),this.setError("stream","The selected stream ("+this.channel.title+") could not load, or stopped loading due to network problems."),this.playing=!1,this.loading=!1},startClock:function(){this.stopClock(),this.timeStart=Date.now(),this.timeItv=setInterval(this.updateClock,1e3),this.updateClock()},updateClock:function(){var t=function(t){return t<10?"0"+t:""+t},e=(Date.now()-this.timeStart)/1e3,i=Math.floor(e%60),n=Math.floor(e/60%60),r=Math.floor(e/3600);this.timeDisplay=t(r)+":"+t(n)+":"+t(i)},stopClock:function(){this.timeItv&&clearInterval(this.timeItv),this.timeItv=null},clearTimers:function(){this.sto&&clearTimeout(this.sto),this.itv&&clearInterval(this.itv),this.anf&&cancelAnimationFrame(this.anf)},setCssHeight:function(t,e){t.style.setProperty("--height",e+"px")},updateHeight:function(){var t=this,e=document.querySelector(":root");this.setCssHeight(e,window.innerHeight),window.addEventListener("resize",function(i){return t.setCssHeight(e,window.innerHeight)})}},mounted:function(){this.loadSortOptions(),this.loadFavorites(),this.setupEvents(),this.getChannels(!0),this.setupCanvas(),this.updateCanvas(),this.setupMaintenance(),this.updateHeight(),this.initPlayer()},destroyed:function(){this.closeAudio(),this.clearTimers()}})},function(t,e){},function(t,e){Vue.filter("toCommas",function(t,e){var i={style:"decimal",minimumFractionDigits:e,maximumFractionDigits:e};return new Intl.NumberFormat("en-US",i).format(t)}),Vue.filter("toText",function(t,e){return(t=String(t||"").replace(/[^\w\`\'\-\,\.\!\?]+/g," ").replace(/\s\s+/g," ").trim())||String(e||"")})},function(t,e){Vue.component("fav-btn",{props:{id:{type:String,default:"",required:!0},active:{type:Boolean,default:!1}},template:'\n    <button class="fav-btn" @click.stop="$emit( \'change\', id, !active )">\n      <i v-if="active" class="fa fa-heart text-primary fx fx-drop-in" key="on"></i>\n      <i v-else class="fa fa-heart-o fx fx-drop-in" key="off"></i>\n    </button>'})},function(t,e,i){"use strict";e.a={getChannels:function(t){var e=this,i="There was a problem fetching the latest list of music channels from SomaFM.";axios.get("https://somafm.com/channels.json").then(function(n){var r=e._parseChannels(n.data.channels);return r.length?t(null,r):t(i,[])}).catch(function(e){return t(i+String(e.message||""),[])})},getSongs:function(t,e){var i=t.songsurl||"",n=t.title||"...",r="There was a problem loading the list of songs for channel "+n+" from SomaFM.";axios.get(i).then(function(t){return t.data.songs?e(null,t.data.songs):e(r,[])}).catch(function(t){return e(r+String(t.message||""),[])})},_parseChannels:function(t){var e=[];if(Array.isArray(t)){var i=!0,n=!1,r=void 0;try{for(var s,a=t[Symbol.iterator]();!(i=(s=a.next()).done);i=!0){var o=s.value;Array.isArray(o.playlists)&&(o.mp3file="https://ice1.somafm.com/"+o.id+"-128-mp3",o.songsurl="https://somafm.com/songs/"+o.id+".json",o.infourl="https://somafm.com/"+o.id+"/",o.twitter=o.twitter?"https://twitter.com/@"+o.twitter:"",o.route="/channel/"+o.id,o.listeners=0|o.listeners,o.updated=0|o.updated,o.favorite=!1,o.active=!1,e.push(o))}}catch(t){n=!0,r=t}finally{try{!i&&a.return&&a.return()}finally{if(n)throw r}}}return e}}},function(t,e,i){"use strict";e.a={_context:null,_audio:null,_source:null,_gain:null,_analyser:null,_freq:new Uint8Array(32),_events:{},setupAudio:function(){var t=this;this._audio&&this._context||(this._audio=new Audio,this._context=new(window.AudioContext||window.webkitAudioContext),this._source=this._context.createMediaElementSource(this._audio),this._analyser=this._context.createAnalyser(),this._gain=this._context.createGain(),this._analyser.fftSize=32,this._source.connect(this._gain),this._source.connect(this._analyser),this._gain.connect(this._context.destination),this._audio.addEventListener("canplay",function(e){t._freq=new Uint8Array(t._analyser.frequencyBinCount),t._audio.play()}),["waiting","playing","ended","stalled","error"].forEach(function(e){t._audio.addEventListener(e,function(i){return t.emit(e,i)})}))},on:function(t,e){t&&"function"==typeof e&&(this._events[t]=e)},emit:function(t,e){t&&this._events.hasOwnProperty(t)&&this._events[t](e)},getFreqData:function(t){this._analyser&&this._analyser.getByteFrequencyData(this._freq);var e=Math.floor(0|this._freq[4])/255;return t?e||.6:e},setVolume:function(t){this._gain&&(t=parseFloat(t)||0,t=t<0?0:t,t=t>1?1:t,this._gain.gain.value=t)},stopAudio:function(){if(this._audio){try{this._audio.pause()}catch(t){}try{this._audio.stop()}catch(t){}try{this._audio.close()}catch(t){}}},playSource:function(t){this.setupAudio(),this.stopAudio(),"suspended"===this._context.state&&this._context.resume().then(function(){console.log("Audio context has been resumed.")}),this._audio.src=String(t||"")+"?x="+Date.now(),this._audio.crossOrigin="anonymous",this._audio.load()}}},function(t,e,i){"use strict";var n=i(7);e.a={_wrap:null,_canvas:null,_renderer:null,_scene:null,_camera:null,_box:null,_mouse:{x:0,y:0},_objects:[],setupCanvas:function(){this._wrap=document.querySelector("#player-wrap"),this._canvas=document.querySelector("#player-canvas"),this._box=this._wrap.getBoundingClientRect(),this._scene=new THREE.Scene,this._renderer=new THREE.WebGLRenderer({canvas:this._canvas,alpha:!0,antialias:!0,precision:"lowp"}),this._renderer.setClearColor(0,0),this._renderer.setPixelRatio(window.devicePixelRatio),this._camera=new THREE.PerspectiveCamera(60,this._box.width/this._box.height,.1,2e4),this._camera.lookAt(this._scene.position),this._camera.position.set(0,0,300),this._camera.rotation.set(0,0,0),this._objects.push(n.a);var t=!0,e=!1,i=void 0;try{for(var r,s=this._objects[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){r.value.create(this._box,this._scene)}}catch(t){e=!0,i=t}finally{try{!t&&s.return&&s.return()}finally{if(e)throw i}}window.addEventListener("mousemove",this.updateMouse.bind(this)),window.addEventListener("resize",this.updateSize.bind(this)),this.updateMouse(),this.updateSize()},updateObjects:function(t){var e=!0,i=!1,n=void 0;try{for(var r,s=this._objects[Symbol.iterator]();!(e=(r=s.next()).done);e=!0){r.value.update(this._box,this._mouse,t)}}catch(t){i=!0,n=t}finally{try{!e&&s.return&&s.return()}finally{if(i)throw n}}this._renderer.render(this._scene,this._camera)},updateSize:function(){this._wrap&&this._canvas&&(this._box=this._wrap.getBoundingClientRect(),this._canvas.width=this._box.width,this._canvas.height=this._box.height,this._camera.aspect=this._box.width/this._box.height,this._camera.updateProjectionMatrix(),this._renderer.setSize(this._box.width,this._box.height))},updateMouse:function(t){if(this._box){var e=this._box.left+this._box.width/2,i=this._box.top+this._box.height/2;t?(this._mouse.x=Math.max(0,t.pageX||t.clientX||0)-e,this._mouse.y=Math.max(0,t.pageY||t.clientY||0)-i):(this._mouse.x=e,this._mouse.y=i)}}}},function(t,e,i){"use strict";e.a={group:null,shapes:[],move:new THREE.Vector3(0,0,0),ease:8,create:function(t,e){this.group=new THREE.Object3D;for(var i=new THREE.CircleGeometry(1,10),n=new THREE.CircleGeometry(2,20),r=new THREE.SphereGeometry(100,30,14).vertices,s=new THREE.MeshNormalMaterial({transparent:!0,opacity:0,side:THREE.DoubleSide}),a=new THREE.Vector3(0,0,0),o=0;o<r.length;o++){var h=r[o],u=h.x,c=h.y,l=h.z,d={x:u,y:c,z:l},f=THREE.Math.randInt(0,100),p=THREE.Math.randInt(10,30),g=new THREE.Mesh(o%2?i:n,s);g.position.set(u,c,l),g.lookAt(a),g.userData={radius:12,cycle:f,pace:p,home:d},this.group.add(g)}this.group.position.set(500,0,0),this.group.rotation.x=Math.PI/2+.6,e.add(this.group)},update:function(t,e,i){var n=t.width<800?0:40,r=t.width<800?-60:20,s=.5+.5*i;this.move.x=n+-.012*e.x,this.group.position.x+=(this.move.x-this.group.position.x)/this.ease,this.group.position.y+=(this.move.y-this.group.position.y)/this.ease,this.group.position.z=r+80*i,this.group.rotation.y-=.003;for(var a=0;a<this.group.children.length;a++){var o=this.group.children[a],h=o.userData,u=h.radius,c=h.cycle,l=h.pace,d=h.home;o.material.opacity=.2+.8*i,o.position.set(d.x,d.y,d.z),o.translateZ(s*Math.sin(c/l)*u),o.userData.cycle++}}}},function(t,e,i){"use strict";e.a={search:function(t,e,i){var n=new RegExp("^("+i+")","i");return t.filter(function(t){return n.test(t[e])})},sort:function(t,e,i,n){return t.sort(function(t,r){if(t.hasOwnProperty(e)){var s=t[e],a=r[e];if(n&&(s="string"==typeof s?s.toUpperCase():s,a="string"==typeof a?a.toUpperCase():a),"asc"===i){if(s<a)return-1;if(s>a)return 1}if("desc"===i){if(s>a)return-1;if(s<a)return 1}}return 0})}}},function(t,e,i){"use strict";e.a={set:function(t,e,i){if(this._isStr(t)){var n=Date.now(),r=Number(i)||0,s=JSON.stringify({time:n,expire:r,data:e});window.localStorage.setItem(t,s)}},get:function(t){if(this._isStr(t)){var e=window.localStorage.getItem(t)||"{}",i=JSON.parse(e)||{},n=i.time,r=i.expire,s=i.data;return this._isExpired(n,r)&&this.delete(t),s}},delete:function(t){this._isStr(t)&&window.localStorage.removeItem(t)},_isStr:function(t){return t&&"string"==typeof t},_isExpired:function(t,e){return!(!t||!e)&&(Date.now()-t)/1e3>=e}}}]);